---
execute:
  echo: true
  eval: false
  error: false
---


## Rstudio project to Zenodo exercise {#sec-Rproj_zenodo_exercise}
The following exercise is heavily based on [@blondel2024]. We have extracted the most relevant parts to explain the workflow. If you are interested in more details, check out their user manual at: https://cran.r-project.org/web/packages/zen4R/vignettes/zen4R.html.

### Publish your work with Zenodo to make it accessible and citable   
#### Install zen4R to access Zenodo through r
For this exercise we will not be using Zenodo directly but Zenodo Sandbox. Zenodo Sandbox is a testing environment provided by Zenodo that allows users to experiment with Zenodo's features without affecting the production environment. It enables developers and researchers to try out the API, test data uploads, and simulate workflows in a safe non-public space.
-   Create an account on https://sandbox.zenodo.org. This is necessary even if you allready have a zenodo account.

-   Zenodo can be accessed with r library zen4R to upload, edit, publish and download data.
    -   Install zen4R library with the following code:
    ```{r}
    ### install dependency "remotes"
    install.packages("remotes")
    
    #install zen4R
    require("remotes")
    install_github("eblondel/zen4R")
    ```

#### Create a new Zenodo record
-   A zenodo record includes metadata, data and a  Digital Object Identifier (DOI) which is automatically generated by Zenodo for all uploads.
    -   Go to https://sandbox.zenodo.org/account/settings/applications/.
    -   Once you're logged in create a new "Personal access token".
    -   Then run the following code in r to c create a new record
    ```{r}
    library(zen4R)
    
    ### Create manager to access your Zenodo repository
    zenodo <- ZenodoManager$new(
      token = "your_token",
      sandbox = TRUE,
      logger = "INFO" 
    )
    
    ### Create a new empty record
    myrec <- ZenodoRecord$new()
    ```
-   If you wanted to connect to Zenodo and not the sandbox, just create the token in your Zenodo account and do not include the sandbox = True in the code above.


-   The types of metadata that can be included in a Zenodo record are vast. A full list can be found in the documentation at https://developers.zenodo.org/#representation. The code below gives some examples:
    ```{r}
    myrec$setTitle("zen4R") ### title of the record
    myrec$addAdditionalTitle("This is an alternative title", type = "alternative-title")
    myrec$setDescription("Interface to 'Zenodo' REST API") #description
    myrec$addAdditionalDescription("This is an abstract", type = "abstract")
    myrec$setPublicationDate("2024-09-16") #Format YYYY-MM-DD
    myrec$setResourceType("dataset")
    myrec$addCreator(firstname = "Manuel", lastname = "Kurmann", role = "datamanager", orcid = "0000-0001-8411-3966")
    myrec$setKeywords(c("R","dataset")) #For filtering
    myrec$addReference("Blondel E. et al., 2024 zen4R: R Interface to Zenodo REST API")
    myrec$setPublisher("CRAN") #Publisher
    ```
    
-   A record can be deposited on Zenodo before it is published. This will add the record to your account without making it public yet. A deposited record can still be edited or deleted. If you prefer a graphical interface, you can also edit the record on the Zenodo website.

    ```{r}
    ### deposit record
    myrec <- zenodo$depositRecord(myrec, publish = TRUE)
    
    ### add data to the record, adjust the path below
    zenodo$uploadFile("path/to/your/file", record = myrec)
    
    ### delete record if you want to start over
    zenodo$deleteRecord(myrec$id)
    ```


-   Once you are satisfied with the record, you can proceed with its publication.
    ```{r}
    ### publish record
    myrec <- zenodo$publishRecord(myrec$id)
    ```
    
#### Edit published Zenodo records
-   It is also possible to edit or update the metadata of published records.

    ```{r}
    ### get your record by metadata query, e.g. by title
    myrec <- zenodo$getDepositions(q='title:zen4R')
    
    ### get depositions creates a list, access first element
    myrec <- myrec[[1]]
    
    ### edit metadata
    myrec <- zenodo$editRecord(myrec$id)
    myrec$setTitle("zen4R 2.0")
    
    #redeposit and publish the edited record
    myrec <- zenodo$depositRecord(myrec, publish = TRUE)
    ```

Once a record has been published, it is not possible to edit the data that has been attached to it. However, it is possible to upload an updated version of the data. The previous version of the data will remain accessible via Zenodo. The record will have one overall DOI, while each version will have its own DOI.

    ```{r}
    ### get your record by metadata query, e.g. by title
    myrec <- zenodo$getDepositions(q='title:zen4R 2.0')
    
    ### get depositions creates a list, access first element
    myrec <- myrec[[1]]
    
    ### edit data, delete_latest_files = TRUE deletes data of previous version,
    myrec <- zenodo$depositRecordVersion(myrec, delete_latest_files = TRUE, files = "path/to/your/new/file", publish = TRUE)
    ```